#!/bin/bash

# the scripting-addition must be loaded manually if
# you are running yabai on macOS Big Sur. Uncomment
# the following line to have the injection performed
# when the config is executed during startup.
#
# for this to work you must configure sudo such that
# it will be able to run the command without password

sudo yabai --load-sa
yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"

yabai -m config layout bsp
yabai -m config top_padding 0
yabai -m config bottom_padding 0
yabai -m config left_padding 0
yabai -m config right_padding 0
# Need a small gap so  windows don't overlap, otherwise focusing east or
# west-ward might wrap around. Similar to what's described here:
# https://github.com/koekeishiya/yabai/issues/1511
yabai -m config window_gap 5

yabai -m config window_opacity on
yabai -m config active_window_opacity 1.0
yabai -m config normal_window_opacity 0.95
# yabai -m config window_opacity_duration      0.0   # https://github.com/koekeishiya/yabai/issues/277#issuecomment-552944282

yabaictl restore-spaces

yabai -m rule --add app="^1Password$" manage=off
yabai -m rule --add app="^AlDente$" manage=off
yabai -m rule --add app="^Activity Monitor$" manage=off
yabai -m rule --add app="^Finder$" manage=off
yabai -m rule --add app="^GoToMeeting$" manage=off
yabai -m rule --add app="^Lunar$" manage=off
yabai -m rule --add app="^Simulator$" manage=off
yabai -m rule --add app="^System Settings$" manage=off
yabai -m rule --add app="^Xcode$" manage=off

yabai -m signal --add event=display_added action='zsh -c "echo display_added && yabaictl restore-spaces"'
yabai -m signal --add event=display_removed action='zsh -c "echo display_removed && yabaictl restore-spaces"'
